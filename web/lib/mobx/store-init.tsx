import { useEffect } from "react";
// next themes
import { useTheme } from "next-themes";
// mobx store
import { useMobxStore } from "lib/mobx/store-provider";

const MobxStoreInit = () => {
  const store: any = useMobxStore();
  const { setTheme } = useTheme();

  useEffect(() => {
    // sidebar collapsed toggle
    if (
      localStorage &&
      localStorage.getItem("app_sidebar_collapsed") &&
      store?.theme?.sidebarCollapsed === null
    )
      store.theme.setSidebarCollapsed(
        localStorage.getItem("app_sidebar_collapsed")
          ? localStorage.getItem("app_sidebar_collapsed") === "true"
            ? true
            : false
          : false
      );

    // theme
    if (store.theme.theme === null && store?.user?.currentUserSettings) {
      let currentTheme = localStorage.getItem("theme");
      currentTheme = currentTheme ? currentTheme : "system";

      // validating the theme and applying for initial state
      if (currentTheme) {
        setTheme(currentTheme);
        store.theme.setTheme({ theme: { theme: currentTheme } });
      }
    }
  }, [store?.theme, store?.user, store.locale, setTheme]);

  useEffect(() => {
    // current user
    if (store?.user?.currentUser === null) store.user.setCurrentUser();

    // current user settings
    if (store?.user?.currentUserSettings === null) store.user.setCurrentUserSettings();

    // current locale
    if (store?.locale?.locale === null) store.locale.setAutoLocale();
  }, [store?.user, store?.locale]);

  return <></>;
};

export default MobxStoreInit;
